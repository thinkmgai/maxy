{
  "aggs": {
    "normalCount": {
      "date_histogram": {
        "field": "appStartTm",
        "interval": "day",
        "time_zone": "Asia/Seoul",
        "format": "yyyy-MM-dd",
        "extended_bounds": {
          "min": #{searchToDay},
          "max": #{searchFromDay}
        }
      }
    }
  },
  "query": {
    "bool": {
      "must": [
        {
          "bool" : {
            "must" : [
              {
                "term" : {
                  "packageNm" : {
                    "value" : #{packageNm}
                  }
                }
              },
              {
                "term" : {
                  "serverType" : {
                    "value" : #{serverType}
                  }
                }
              },
              #[isAppVer]
              {
                "term" : {
                  "appVer" : {
                    "value" : #{appVer}
                  }
                }
              },
              #[/isAppVer]
              {
                "term" : {
                  "activeSt" : {
                    "value" : "Y"
                  }
                }
              },
              {
                "range": {
                  "appStartTm": {
                    "gte": #{searchToDt},
                    "lte": #{searchFromDt},
                    "format": "epoch_millis"
                  }
                }
              },
              {
                "bool": {
                  "must" : [
                    {
                      "terms": {
                        "deviceSt": ["N", "R"]
                      }
                    },
                    {
                      "term" : {
                        "appReinstallYn": "N"
                      }
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    }
  }
}